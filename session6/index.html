<!--having a html page that contains a form to submit the information to php for CRUD operation-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container mt-5">
    <h1>User Management</h1>
    <form id="userForm" class="mb-3">
      <div class="row g-3">
        <div class="col-md-4">
          <input
            type="text"
            id="name"
            class="form-control"
            placeholder="Name"
            required
          />
        </div>
        <div class="col-md-4">
          <input
            type="email"
            id="email"
            class="form-control"
            placeholder="Email"
            required
          />
        </div>
        <div class="col-md-4">
          <button type="submit" class="btn btn-primary">Add User</button>
        </div>
      </div>
    </form>
    <ul id="userList" class="list-group"></ul>
  </body>

  <script>
    const apiBase = "http://localhost/fsd14/session6/";

    function fetchUsers() {
      fetch(apiBase + "/read.php")
        .then((res) => res.json())
        .then((data) => {
          const list = document.getElementById("userList");
          list.innerHTML = "";
          data.forEach((user) => {
            const item = document.createElement("li");
            item.className =
              "list-group-item d-flex justify-content-between align-items-center";
            item.innerHTML = `
              <span>${user.username} - ${user.email}</span>
              <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>

            `;
            list.appendChild(item);
          });
        });
    }

    document
      .getElementById("userForm")
      .addEventListener("submit", function (e) {
        e.preventDefault();
        const username = document.getElementById("name").value;
        const email = document.getElementById("email").value;

        fetch(apiBase + "/create.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, email }),
        })
          .then((res) => res.json())
          .then(() => fetchUsers());
      });

    function deleteUser(id) {
      fetch(apiBase + `/delete.php?id=${id}`)
        .then((res) => res.json())
        .then(() => fetchUsers());
    }

    fetchUsers();
  </script>
</html>
